{% extends 'to_center.html' %}
{% block content %}
    <form action="{% url 'step7' %}" method="post" enctype="multipart/form-data" class="form-group">
    <h1>Публикация данных</h1>
        <h2>Шаг 7: добавьте информацию об объектах</h2>

        <p>Основные данные об объектах находятся в разделе <a href="#title-related-data">Связанные данные</a>. Данный
            раздел содержит ве поля таблиц,
            на которые ссылается выбранна таблица с координатами.</p>

        <p>Если в этом разделе вам не удалось найти необходимые поля,
            обратитесь к разделу <a href="#title-for-tables-with-links-on-main-table">Ссылающиеся таблицы</a>.
            Этот раздел содержит таблицы, которые ссылаются на выбранную таблицу с координатами и на все таблицы,
            связанные с ней.</p>

        <h2 id="title-related-data">Связанные данные</h2>

        <p>Для того, чтобы добавить информацию об объектах, выберете поля, содержащие необходимую информацию о них.
            Для этого необходимо поставить соотвествующие галочки возле требуемого поля</p>
        <ul>
            <li>* - использовать поле для отображения инофрмации об объектах на карте.</li>
            <li>** - использовать поле для фильтрации объектов.</li>
            <li>*** - отметить поле как обязательное. Указанные поля будут обязательными при добавлении новых данных на
                содаваемую карту.
                Т.е. при добавлении новых объектов на текущую карту, в новом источнике данных нужно будет выбрать
                информацию, аналогичную хранимой в поле, отмеченном, как обязательное.
            </li>
        </ul>
        {% if errors %}
            <div class="alert alert-danger field-errors">
                <ul>
                    {% for error in errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}
        <div class="fields-with-path">
            <table class="table-for-fields-with-path">
                <tr>
                    <th>Поля связанных таблиц</th>
                    <th class="table-cell-for-choose-fields">*</th>
                    <th class="table-cell-for-choose-fields">**</th>
                    <th class="table-cell-for-choose-fields">***</th>
                    <th style="width: 130px;">Название поля</th>
{#                        <th>Обязательные поля карты</th>#}
                </tr>
            </table>
        </div>
        <div class="results">
            {% include "tree.html" with tree=tree %}
        </div>
        <h2 id="title-for-tables-with-links-on-main-table">Ссылающиеся таблицы</h2>

        <div>
            <ul>
                {% for table, to_table_links, links in table_info_links %}

                <div class="table">
                    <input type="checkbox" name="table_{{ table.name }}" value="{{ table.name }}" id="{{ table.name }}">
                    <label class="label-for-radio-tables"
                           for="{{ table.name }}"> {{ table.name }}</label>
                </div>
                <div class="btn-for-table">
                    <button class="btn btn-info no-border-radius no-margin-top button-for-table non-checked-btn-for-table button"
                            table-name="{{ table.name }}" data-title="Показать поля таблицы"
                            id="button-open-for-{{ table.name }}">
                        <span class="icons glyphicon glyphicon-plus" id="span-for-{{ table.name }}"
                              aria-hidden="true"></span></button>
                </div>
                <div class="btn-for-table">
                    <button class="btn btn-info no-border-radius no-margin-top button-for-table checked-btn-for-table button"
                            table-name="{{ table.name }}" data-title="Скрыть поля таблицы"
                            id="button-close-for-{{ table.name }}">
                        <span class="icons glyphicon glyphicon-minus" id="span-for-{{ table.name }}"
                              aria-hidden="true"></span></button>
                </div>
                <ul style="padding-left: 40px">
                    {% for link in links %}
                        <li>{{ table.name }} -> {{ link }}</li>
                    {% endfor %}
                </ul>

                <ul style="padding-left: 40px">
                    {% for link in to_table_links %}
                        <li>{{ link.table }} -> {{ table.name }}</li>
                    {% endfor %}
                </ul>


                <div class="table_fields">
                    <p class="p-for-tables" id="p-for-{{ table.name }}">
                        {% for column in table.columns %}
                            {% if forloop.last %}
                                {{ column.name }}
                            {% else %}
                                {{ column.name }},
                            {% endif %}
                        {% endfor %}
                    </p>
                </div>
                {% endfor %}
            </ul>
        </div>
        {% csrf_token %}
        <input type="submit" class="btn btn-info no-border-radius" value="Выбрать"/>
    </form>
    <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src="/static/script.js" type="text/javascript"></script>
    <script>
        find_spoilers('.results');
    </script>
{% endblock %}
